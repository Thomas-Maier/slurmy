<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Interactive Slurmy - Slurmy</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Interactive Slurmy";
    var mkdocs_page_input_path = "interactive_slurmy.md";
    var mkdocs_page_url = "/interactive_slurmy/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Slurmy</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      


  
    
    
    
    
    
    

  <p class="caption">Slurmy</p>


<ul class="current" href="index">
  
    
      
<li class=" toctree-l1">
  <a href=".." title="Slurmy"
      class="">
    Slurmy
  </a>

  
  
</li>
    
      
<li class=" toctree-l1">
  <a href="../howto/" title="HowTo"
      class="">
    HowTo
  </a>

  
  
</li>
    
      
<li class="current toctree-l1">
  <a href="./" title="Interactive Slurmy"
      class="current">
    Interactive Slurmy
  </a>

  
  
    
    
      
  
  
  
  
  <ul class="current subnav">
    
      

  
  
  


  <li class="toctree-l2 toc-item">
    <a href="#example-usage" title="Interactive Slurmy">Example usage</a>
  </li>

    
      

  
  


  <li class="toctree-l2 toc-item">
    <a href="#job-configuration-file" title="Interactive Slurmy">Job configuration file</a>
  </li>

    
      

  
  


  <li class=" toctree-l2">
    
      <a href="#interactive-slurmy-functions" title="Interactive Slurmy"
          class="">
        Interactive slurmy functions
      </a>
    
    <ul class=" subnav">
      
        

  
  


  <li class="toctree-l2 toc-item">
    <a href="#list_sessions" title="Interactive Slurmy">list_sessions</a>
  </li>

      
        

  
  


  <li class="toctree-l2 toc-item">
    <a href="#load" title="Interactive Slurmy">load</a>
  </li>

      
        

  
  


  <li class="toctree-l2 toc-item">
    <a href="#load_path" title="Interactive Slurmy">load_path</a>
  </li>

      
        

  
  


  <li class="toctree-l2 toc-item">
    <a href="#load_latest" title="Interactive Slurmy">load_latest</a>
  </li>

      
    </ul>
  </li>

    
  </ul>

    
  
</li>
    
</ul>

<!--
 | This is a hacky way to pass setting from the template generator to the
 | javascript that drives the dropdown functionality
-->
<div style="width: 1px; height: 1px; visibility: none;">

</div>



  
    
    
    
    
    
    

  <p class="caption">Classes</p>


<ul class="" href="classes/JobHandler">
  
    
      
<li class=" toctree-l1">
  <a href="../classes/JobHandler/" title="JobHandler"
      class="">
    JobHandler
  </a>

  
  
</li>
    
      
<li class=" toctree-l1">
  <a href="../classes/JobHandlerConfig/" title="JobHandlerConfig"
      class="">
    JobHandlerConfig
  </a>

  
  
</li>
    
      
<li class=" toctree-l1">
  <a href="../classes/JobContainer/" title="JobContainer"
      class="">
    JobContainer
  </a>

  
  
</li>
    
      
<li class=" toctree-l1">
  <a href="../classes/Job/" title="Job"
      class="">
    Job
  </a>

  
  
</li>
    
      
<li class=" toctree-l1">
  <a href="../classes/JobConfig/" title="JobConfig"
      class="">
    JobConfig
  </a>

  
  
</li>
    
      
<li class=" toctree-l1">
  <a href="../classes/Listener/" title="Listener"
      class="">
    Listener
  </a>

  
  
</li>
    
</ul>

<!--
 | This is a hacky way to pass setting from the template generator to the
 | javascript that drives the dropdown functionality
-->
<div style="width: 1px; height: 1px; visibility: none;">

</div>



  
    
    
    
    
    
    

  <p class="caption">Utility</p>


<ul class="" href="utils/SuccessTrigger">
  
    
      
<li class=" toctree-l1">
  <a href="../utils/SuccessTrigger/" title="SuccessTrigger"
      class="">
    SuccessTrigger
  </a>

  
  
</li>
    
      
<li class=" toctree-l1">
  <a href="../utils/FinishedTrigger/" title="FinishedTrigger"
      class="">
    FinishedTrigger
  </a>

  
  
</li>
    
      
<li class=" toctree-l1">
  <a href="../utils/LogMover/" title="LogMover"
      class="">
    LogMover
  </a>

  
  
</li>
    
</ul>

<!--
 | This is a hacky way to pass setting from the template generator to the
 | javascript that drives the dropdown functionality
-->
<div style="width: 1px; height: 1px; visibility: none;">

</div>


      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Slurmy</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Slurmy &raquo;</li>
        
      
    
    <li>Interactive Slurmy</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>You can use the <code>slurmy</code> executable to start an interactive slurmy session, which allows to interact with past JobHandler sessions or start new ones.</p>
<p>Usage from <code>slurmy --help</code>:</p>
<pre><code class="shell">usage: slurmy [-h] [-p PATH] [-c CONFIG] [-t] [--debug]

Slurmy interactive

optional arguments:
  -h, --help            show this help message and exit
  -p PATH, --path PATH  Path to the base folder of an existing JobHandler
                        session. Directly loads the JobHandler as &quot;jh&quot;.
  -c CONFIG, --config CONFIG
                        Path to a job configuration file.
  -t                    Switch to start in test mode.
  --debug               Run in debugging mode.
</code></pre>

<p>If you prefer to use python2 (not recommended), you can also run the <code>slurmy2</code> executable.</p>
<p>If no argument is passed to the slurmy executable, it tries to load the latest session according to the bookkeeping and load it as <code>jh</code>.</p>
<h1 id="example-usage">Example usage</h1>
<p>In general you can do everything in interactive slurmy that you can also do in python file which handles your job definition. On top of that you can easily inspect and manipulate an already existing <a href="../classes/JobHandler/">JobHandler</a> session. Just executing <code>slurmy</code> will bring up the latest <a href="../classes/JobHandler/">JobHandler</a> session:</p>
<pre><code class="python">In [1]: jh
Out[1]: MyAnalysis_1531405633
</code></pre>

<p>Every <a href="../classes/JobHandler/">JobHandler</a> has a member <code>jobs</code> which keeps track of all it's attached jobs:</p>
<pre><code class="python">In [2]: jh.jobs
Out[2]: 
Job &quot;ttbar&quot;: CONFIGURED
Job &quot;wjets&quot;: CONFIGURED
Job &quot;ww&quot;: CONFIGURED
Job &quot;data&quot;: CONFIGURED
------------
CONFIGURED(4)
</code></pre>

<p>As you can see, the <a href="../classes/JobHandler/">JobHandler</a> in this case has four jobs named "data", "ttbar", "wjets", and "ww", which is in the CONFIGURED state. Every job is attached as property to <a href="../classes/JobHandler/">JobHandler</a>.jobs, which provides a direct handle to access them:</p>
<pre><code class="python">In [3]: jh.jobs.ww
Out[3]: 
Job &quot;ww&quot;
Type: BATCH
Backend: Slurm
Script: /home/t/Thomas.Maier/testSlurmy/MyAnalysis_1531405633/scripts/ww
Status: CONFIGURED
Tags: {'bkg', 'ww'}
</code></pre>

<p>Alternatively, jobs can be accessed directly by name via the <a href="../classes/JobHandler/">JobHandler</a> itself:</p>
<pre><code class="python">In [4]: jh['ww']
Out[4]: 
Job &quot;ww&quot;
Type: BATCH
Backend: Slurm
Script: /home/t/Thomas.Maier/testSlurmy/MyAnalysis_1531405633/scripts/ww
Status: CONFIGURED
Tags: {'bkg', 'ww'}
</code></pre>

<p><a href="../classes/JobHandler/">JobHandler</a>.jobs also has a <code>status_</code> property for every possible job status, which will print all jobs which currently are in this status:</p>
<pre><code class="python">In [5]: jh.jobs.status_CONFIGURED
Job &quot;wjets&quot;: CONFIGURED
Job &quot;data&quot;: CONFIGURED
Job &quot;ww&quot;: CONFIGURED
Job &quot;ttbar&quot;: CONFIGURED

In [6]: jh.jobs.status_RUNNING


In [7]:
</code></pre>

<p>As you've seen above, the job "ww" (and "ttbar" and "wjets" for that matter) has a tag "bkg", which was attached to the job via the <code>tags</code> option of <a href="../classes/JobHandler/#add_job">JobHandler.add_job()</a>. You can get the printout for jobs only tagged with "bkg" by calling the <a href="../classes/JobContainer/#print">JobContainer.print()</a> method:</p>
<pre><code class="python">In [7]: jh.jobs.print(tags='bkg')
Job &quot;wjets&quot;: CONFIGURED
Job &quot;ww&quot;: CONFIGURED
Job &quot;ttbar&quot;: CONFIGURED
------------
CONFIGURED(3)
</code></pre>

<p>In this example, all jobs are in the CONFIGURED state so we can run the job submission with <a href="../classes/JobHandler/#run_jobs">JobHandler.run_jobs()</a>:</p>
<pre><code class="python">In [8]: jh.run_jobs()
all: 100%|██████████████████████████████████████████████████████████████| 4/4 [, S=3, F=1, C=0]
-data: 100%|████████████████████████████████████████████████████████████| 1/1 [, S=1, F=0, C=0]
-bkg: 100%|█████████████████████████████████████████████████████████████| 3/3 [, S=2, F=1, C=0]
--ttbar: 100%|██████████████████████████████████████████████████████████| 1/1 [, S=1, F=0, C=0]
--wjets: 100%|██████████████████████████████████████████████████████████| 1/1 [, S=1, F=0, C=0]
--ww: 100%|█████████████████████████████████████████████████████████████| 1/1 [, S=0, F=1, C=0]

Jobs processed (batch/local/all): (4/0/4)
     successful (batch/local/all): (3/0/3)
     failed (batch/local/all): (1/0/1)
Time spent: 12.4 s
</code></pre>

<p>You can see that this produces two different printouts. During the processing you'll get progress bars which indicate how many jobs are completed. On the very right of these progess bars you can also see how many jobs ended up in the SUCCESS(S), FAILED(F), or CANCELLED(C) state. You can also see that for each tag that is introduced with <a href="../classes/JobHandler/#add_job">JobHandler.add_job()</a> one progress bar is displayed, which keeps track of the jobs assigned with this tag. Slurmy will also evaluate the tag hierarchy dependent on how tags were assigned to jobs and order them accordingly in this printout. In this example, each job has it's own name as tag and "ww", "ttbar", and "wjets" have "bkg" as an additional tag.</p>
<p>As you can see from the printout above, job "ww" ended up in FAILED state.</p>
<pre><code class="python">In [9]: jh.jobs.ww
Out[9]: 
Job &quot;ww&quot;
Type: BATCH
Backend: Slurm
Script: /home/t/Thomas.Maier/testSlurmy/MyAnalysis_1531405633/scripts/ww
Status: FAILED
Tags: {'bkg', 'ww'}
</code></pre>

<p>We can access the log file of the job directly with <a href="../classes/Job/#log">Job.log</a> (which opens the log file with <code>less</code>), in order to find out what went wrong:</p>
<pre><code class="python">In [10]: jh.jobs.ww.log
</code></pre>

<p>Usually, you probably want to fix your job configuration setup to fix a systematic problem in the job's run script creation. However, you can edit the run script directly:</p>
<pre><code class="python">In [11]: jh.jobs.ww.edit_script()
</code></pre>

<p>If any of the jobs ended up in FAILED or CANCELLED state, they can be retried by passing <code>retry = True</code> to <code>run_jobs</code>:</p>
<pre><code class="python">In [12]: jh.run_jobs(retry = True)
all: 100%|██████████████████████████████████████████████████████████████| 4/4 [, S=4, F=0, C=0]
-data: 100%|████████████████████████████████████████████████████████████| 1/1 [, S=1, F=0, C=0]
-bkg: 100%|█████████████████████████████████████████████████████████████| 3/3 [, S=3, F=0, C=0]
--ttbar: 100%|██████████████████████████████████████████████████████████| 1/1 [, S=1, F=0, C=0]
--wjets: 100%|██████████████████████████████████████████████████████████| 1/1 [, S=1, F=0, C=0]
--ww: 100%|█████████████████████████████████████████████████████████████| 1/1 [, S=1, F=0, C=0]

Jobs processed (batch/local/all): (4/0/4)
     successful (batch/local/all): (4/0/4)
Time spent: 2.5 s
</code></pre>

<p>The job "ww" is now in SUCCESS state (from fixing the run script before retrying the job):</p>
<pre><code class="python">In [13]: jh.jobs.ww
Out[13]: 
Job &quot;ww&quot;
Type: BATCH
Backend: Slurm
Script: /home/t/Thomas.Maier/testSlurmy/MyAnalysis_1531405633/scripts/ww
Status: SUCCESS
Tags: {'bkg', 'ww'}
</code></pre>

<p>Finally, if you want to start from a clean slate you can reset the <a href="../classes/JobHandler/">JobHandler</a> completely:</p>
<pre><code class="python">In [14]: jh.reset()
In [15]: jh.run_jobs()
all: 100%|██████████████████████████████████████████████████████████████| 4/4 [, S=4, F=0, C=0]
-data: 100%|████████████████████████████████████████████████████████████| 1/1 [, S=1, F=0, C=0]
-bkg: 100%|█████████████████████████████████████████████████████████████| 3/3 [, S=3, F=0, C=0]
--ttbar: 100%|██████████████████████████████████████████████████████████| 1/1 [, S=1, F=0, C=0]
--wjets: 100%|██████████████████████████████████████████████████████████| 1/1 [, S=1, F=0, C=0]
--ww: 100%|█████████████████████████████████████████████████████████████| 1/1 [, S=1, F=0, C=0]

Jobs processed (batch/local/all): (4/0/4)
     successful (batch/local/all): (4/0/4)
Time spent: 11.3 s
</code></pre>

<p>In this case you actually might want to start again from the job configuration script that you wrote for your job submission.</p>
<p>Have a look at the <a href="../classes/JobHandler/">JobHandler</a> and <a href="../classes/Job/">Job</a> documentation to see what you can execute in interactive slurmy.</p>
<h1 id="job-configuration-file">Job configuration file</h1>
<p>The job definition file passed with <code>-c</code> is a convenient way to make job definitions. Inside the slurmy session, all necessary imports, like JobHandler and the backend classes, are already provided. This allows for skimmed down JobHandler setups that then can be further interacted with (you can omit import statements). As long as your definition file is "flat" (no encapsulated definitions), i.e. like the examples given in the <a href="../howto/">HowTo</a> section, you can pass it to interactive slurmy.</p>
<h1 id="interactive-slurmy-functions">Interactive slurmy functions</h1>
<p>The interactive slurmy session also defines a couple of functions.</p>
<h2 id="list_sessions">list_sessions</h2>
<pre><code class="python">list_sessions()
</code></pre>

<p>List all available slurmy session according to the central bookkeeping.</p>
<h2 id="load">load</h2>
<pre><code class="python">load(name)
</code></pre>

<p>Load a slurmy session by name.</p>
<ul>
<li><code>name</code> Name of the slurmy session, as listed by list_sessions().</li>
</ul>
<p>Returns jobhandler associated to the session (JobHandler).</p>
<h2 id="load_path">load_path</h2>
<pre><code class="python">load_path(path)
</code></pre>

<p>Load a slurmy session by full path.</p>
<ul>
<li><code>path</code> Full folder path of the slurmy session, as listed by list_sessions().</li>
</ul>
<p>Returns jobhandler associated to the session (JobHandler).</p>
<h2 id="load_latest">load_latest</h2>
<pre><code class="python">load_latest()
</code></pre>

<p>Load the latest slurmy session according to central bookkeeping.</p>
<p>Returns jobhandler associated to the session (JobHandler).</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../classes/JobHandler/" class="btn btn-neutral float-right" title="JobHandler">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../howto/" class="btn btn-neutral" title="HowTo"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../howto/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../classes/JobHandler/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
