#!/usr/bin/env python3

import argparse
import logging
from slurmy import JobHandler
from slurmy.tools.utils import _get_prompt, list_sessions, load

## TODO: encapsulate utility in helper functions that just take jobhandler/job instances (instead of putting everything into the classes)
## TODO: allow for passing a config file, which holds the full jobs conifguration

if __name__ == '__main__':
  _parser = argparse.ArgumentParser(description = 'Slurmy interactive')
  _parser.add_argument('-p', '--path', metavar = 'PATH', dest = 'path', type = str, default = None, help = 'Path to existing session')
  _parser.add_argument('--debug', dest = 'debug', action = 'store_true', default = False, help = 'Debug mode')
  _args = _parser.parse_args()
  if _args.debug: _log.setLevel(level = logging.DEBUG)
  _jh_name = _args.path
  if _jh_name:
    _jh_path = ''
    if '/' in _jh_name:
      _jh_path = jh_name.rsplit('/', 1)[0]
      _jh_name = jh_name.rsplit('/', 1)[-1]

    jh = JobHandler(name = _jh_name, work_dir = _jh_path, use_snapshot = True)
  _prompt = _get_prompt()
  _prompt()
