#!/usr/bin/env python3

import argparse
import os
import logging
from slurmy import JobHandler
from slurmy.backends import Slurm
from slurmy.tools.utils import _get_prompt, list_sessions, load, load_path

_log = logging.getLogger('slurmy')


if __name__ == '__main__':
  _parser = argparse.ArgumentParser(description = 'Slurmy interactive')
  _parser.add_argument('-p', '--path', metavar = 'PATH', dest = 'path', type = str, default = None, help = 'Path to existing session')
  _parser.add_argument('-c', '--config', metavar = 'CONFIG', dest = 'config', type = str, default = None, help = 'Job configuration file')
  _parser.add_argument('--debug', dest = 'debug', action = 'store_true', default = False, help = 'Debug mode')
  _args = _parser.parse_args()
  if _args.debug: _log.setLevel(level = logging.DEBUG)
  if _args.path: jh = load_path(_args.path)
  ## Load config file if one was provided
  if _args.config:
    with open(_args.config, 'r') as in_file:
      exec(in_file.read())
  ## Load interactive session
  _get_prompt()()
