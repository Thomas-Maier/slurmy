<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>HowTo - Slurmy</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "HowTo";
    var mkdocs_page_input_path = "howto.md";
    var mkdocs_page_url = "/howto/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Slurmy</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      


  
    


<ul class="" href="/">
  
    
    
      <li class=" toctree-l1">
        <a class="" href="/">Slurmy</a>
      </li>
</ul>

<!--
 | This is a hacky way to pass setting from the template generator to the
 | javascript that drives the dropdown functionality
-->
<div style="width: 1px; height: 1px; visibility: none;">

</div>



  
    


<ul class="current" href="/howto/">
  
    
    
      <li class="current toctree-l1">
        <a class="current" href="/howto/">HowTo</a>
        
  
  
  
  
  
  
  
  
  <ul class="current subnav">
    
      

  
  
  


  <li class="toctree-l2 toc-item">
    <a href="#general-usage" title="HowTo">General Usage</a>
  </li>

    
      

  
  


  <li class="toctree-l2 toc-item">
    <a href="#what-you-want-to-do-before-doing-anything-else" title="HowTo">What you want to do before doing anything else</a>
  </li>

    
      

  
  


  <li class="toctree-l2 toc-item">
    <a href="#snapshots" title="HowTo">Snapshots</a>
  </li>

    
      

  
  


  <li class=" toctree-l2">
    
      <a href="#simple-example" title="HowTo"
          class="">
        Simple example
      </a>
    
    <ul class=" subnav">
      
        

  
  


  <li class="toctree-l2 toc-item">
    <a href="#with-explicit-backend-definition" title="HowTo">With explicit backend definition</a>
  </li>

      
    </ul>
  </li>

    
      

  
  


  <li class="toctree-l2 toc-item">
    <a href="#using-an-already-existing-script-file-with-optional-arguments" title="HowTo">Using an already existing script file (with optional arguments)</a>
  </li>

    
      

  
  


  <li class="toctree-l2 toc-item">
    <a href="#chaining-jobs-with-tags" title="HowTo">Chaining Jobs with Tags</a>
  </li>

    
      

  
  


  <li class=" toctree-l2">
    
      <a href="#custom-evaluations-for-success-finished-and-post-execution" title="HowTo"
          class="">
        Custom evaluations for success, finished, and post-execution
      </a>
    
    <ul class=" subnav">
      
        

  
  


  <li class="toctree-l2 toc-item">
    <a href="#regarding-class-definitions" title="HowTo">Regarding class definitions</a>
  </li>

      
    </ul>
  </li>

    
  </ul>

      </li>
</ul>

<!--
 | This is a hacky way to pass setting from the template generator to the
 | javascript that drives the dropdown functionality
-->
<div style="width: 1px; height: 1px; visibility: none;">

</div>



  
    


<ul class="" href="/interactive_slurmy/">
  
    
    
      <li class=" toctree-l1">
        <a class="" href="/interactive_slurmy/">Interactive Slurmy</a>
      </li>
</ul>

<!--
 | This is a hacky way to pass setting from the template generator to the
 | javascript that drives the dropdown functionality
-->
<div style="width: 1px; height: 1px; visibility: none;">

</div>



  
    
    
    
    
    
    

  <p class="caption">Classes</p>


<ul class="" href="classes/JobHandler">
  
    
      
<li class=" toctree-l1">
  <a href="../classes/JobHandler/" title="JobHandler"
      class="">
    JobHandler
  </a>

  
  
</li>
    
      
<li class=" toctree-l1">
  <a href="../classes/JobHandlerConfig/" title="JobHandlerConfig"
      class="">
    JobHandlerConfig
  </a>

  
  
</li>
    
      
<li class=" toctree-l1">
  <a href="../classes/JobContainer/" title="JobContainer"
      class="">
    JobContainer
  </a>

  
  
</li>
    
      
<li class=" toctree-l1">
  <a href="../classes/Job/" title="Job"
      class="">
    Job
  </a>

  
  
</li>
    
      
<li class=" toctree-l1">
  <a href="../classes/JobConfig/" title="JobConfig"
      class="">
    JobConfig
  </a>

  
  
</li>
    
</ul>

<!--
 | This is a hacky way to pass setting from the template generator to the
 | javascript that drives the dropdown functionality
-->
<div style="width: 1px; height: 1px; visibility: none;">

</div>



  
    
    
    
    
    
    

  <p class="caption">Utility</p>


<ul class="" href="utils/SuccessOutputFile">
  
    
      
<li class=" toctree-l1">
  <a href="../utils/SuccessOutputFile/" title="SuccessOutputFile"
      class="">
    SuccessOutputFile
  </a>

  
  
</li>
    
      
<li class=" toctree-l1">
  <a href="../utils/SuccessTrigger/" title="SuccessTrigger"
      class="">
    SuccessTrigger
  </a>

  
  
</li>
    
      
<li class=" toctree-l1">
  <a href="../utils/FinishedTrigger/" title="FinishedTrigger"
      class="">
    FinishedTrigger
  </a>

  
  
</li>
    
      
<li class=" toctree-l1">
  <a href="../utils/LogMover/" title="LogMover"
      class="">
    LogMover
  </a>

  
  
</li>
    
</ul>

<!--
 | This is a hacky way to pass setting from the template generator to the
 | javascript that drives the dropdown functionality
-->
<div style="width: 1px; height: 1px; visibility: none;">

</div>


      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Slurmy</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>HowTo</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="general-usage">General Usage</h2>
<p>You can just write a piece of python code that imports the required slurmy classes (e.g. <a href="../classes/JobHandler/">JobHandler</a> and the backend class of your choice), defines jobs and calls the job submission. Job execution definitions can either be provided by already written batch shell scripts, or by defining the content of the shell script directly in your python code. For both cases, arguments that should be passed upon the execution to the scripts can also be specified.</p>
<p><a name="slurmyconfig"></a></p>
<h2 id="what-you-want-to-do-before-doing-anything-else">What you want to do before doing anything else</h2>
<p>You can (and should) specify a slurmy config file, which defines your default configuration of relevant slurmy properties. In particular you can define which batch system backend you want to use and how it should be configured. This safes you from having to specify this every single time you want to use slurmy.</p>
<p>You just need to create a file <code>~/.slurmy</code> with this content (which you might want to modify):</p>
<pre><code class="shell">bookkeeping = ~/.slurmy_bookkeeping
workdir = ./
backend = Slurm
## Slurm backend options
Slurm.partition = lsschaile
#Slurm.clusters = 
#Slurm.qos = 
#Slurm.exclude =
#Slurm.mem =
#Slurm.time =
#Slurm.export =
</code></pre>

<p><a name="snapshots"></a></p>
<h2 id="snapshots">Snapshots</h2>
<p>By default, slurmy will do bookkeeping of past <a href="../classes/JobHandler/">JobHandler</a> sessions. The information is stored in a json file, which is defined in the slurmy config. Snapshot making can be deactivated by passing the respective argument to <a href="../classes/JobHandler/#JobHandler">JobHandler</a>.</p>
<p>Snapshot making is very useful, in particular if you want to make use of <a href="../interactive_slurmy/">interactive slurmy</a>.</p>
<h2 id="simple-example">Simple example</h2>
<pre><code class="python">from slurmy import JobHandler

## Set up the JobHandler
jh = JobHandler()
## Define the run script content
run_script = &quot;&quot;&quot;
echo &quot;hans&quot;
&quot;&quot;&quot;
## Add a job
jh.add_job(run_script = run_script)
## Run all jobs
jh.run_jobs()
</code></pre>

<h3 id="with-explicit-backend-definition">With explicit backend definition</h3>
<p>If you don't create a slurmy config file specifying the batch system backend to use, or if you want to specify backends for each job, then you can do the following.</p>
<pre><code class="python">from slurmy import JobHandler, Slurm

## Set up the backend
slurm = Slurm(partition = 'lsschaile')
## Set up the JobHandler
jh = JobHandler(backend = slurm)
## Define the run script content
run_script = &quot;&quot;&quot;
echo &quot;hans&quot;
&quot;&quot;&quot;
## Add a job
### The backend can be individually set for each job
slurm_job = Slurm(partition = 'lsschaile', mem = '6000mb')
jh.add_job(backend = slurm_job, run_script = run_script)
## Run all jobs
jh.run_jobs()
</code></pre>

<h2 id="using-an-already-existing-script-file-with-optional-arguments">Using an already existing script file (with optional arguments)</h2>
<p>You can also just use an existing script file. In this case you just specify the file path as <code>run_script</code>. You can also specify additional arguments to be passed to the run script.</p>
<pre><code class="python">from slurmy import JobHandler

## Set up the JobHandler
jh = JobHandler()
## Specify path to run script on disk
run_script = '/path/to/run_script'
## Additional arguments to be passed to the run script
run_args = 'hans horst'
## Add a job
jh.add_job(run_script = run_script, run_args = run_args)
## Run all jobs
jh.run_jobs()
</code></pre>

<h2 id="chaining-jobs-with-tags">Chaining Jobs with Tags</h2>
<p>Jobs can be connected by adding tags and parent tags to them. Jobs with parent tags X,Y, and Z will only be executed if all jobs that have the tags X, Y, or Z have successfully finished.</p>
<pre><code class="python">from slurmy import JobHandler

## Set up the JobHandler
jh = JobHandler()
## Define the run script content of job 1
run_script_1 = &quot;&quot;&quot;
sleep 10
echo &quot;hans&quot;
&quot;&quot;&quot;
## Add job 1 with tag &quot;hans&quot;
jh.add_job(run_script = run_script_1, tags = 'hans')
## Define the run script content of job 2
run_script_2 = &quot;&quot;&quot;
echo &quot;horst&quot;
&quot;&quot;&quot;
## Add job 2 with parent_tag &quot;hans&quot;
jh.add_job(run_script = run_script_2, parent_tags = 'horst')
## Run all jobs
jh.run_jobs()
</code></pre>

<h2 id="custom-evaluations-for-success-finished-and-post-execution">Custom evaluations for success, finished, and post-execution</h2>
<p>By default, the exitcode of the job (either taken from the local process or from the batch system bookkeeping) is taken to determine if it was successful or not. However, you can define a custom success condition by creating a dedicated class with __call__ defined. The function has to have exactly one argument, which is the config instance of the job. If <code>success_func</code> was defined during add_job, the custom definition will be used instead of the default one during the success evaluation.</p>
<p>This example uses the predefined <a href="../utils/SuccessOutputFile/">SuccessOutputFile</a> class, which checks if the output associated to job exists on disk in order to evaluate whether if it succeeded or not.</p>
<pre><code class="python">from slurmy import JobHandler, SuccessOutputFile

## Set up success evaluation class which checks if the job's output exists or not
sf = SuccessOutputFile()
## Set up the JobHandler
jh = JobHandler(success_func = sf)
## Define the run script content
run_script = &quot;&quot;&quot;
touch ~/hans.txt
&quot;&quot;&quot;
## Add a job, specifying the output of the job.
##The success evaluation class can be specified for each job separately.
jh.add_job(run_script = run_script, output = '~/hans.txt', success_func = sf)
## Run all jobs
jh.run_jobs()
</code></pre>

<p>In the same way as <code>success_func</code>, you can also define <code>finished_func</code>, to evaluate if a job is finished, or <code>post_func</code>, to define a post-processing which will be done locally after the job's success evaluation was done.</p>
<h3 id="regarding-class-definitions">Regarding class definitions</h3>
<p>Due to technically reasons connected to the <a href="./#snapshots">snapshot feature</a>, your custom class definition must be known to python on your machine. The best way to ensure that is to make the definition known to python via PYTHONPATH. In principle you can just use a local function definition instead of a callable class if you don't want to use the snapshot feature. However, it is highly recommended to make use of it.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../interactive_slurmy/" class="btn btn-neutral float-right" title="Interactive Slurmy">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="Slurmy"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../interactive_slurmy/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
